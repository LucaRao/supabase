import Layout from '~/layouts/DefaultGuideLayout'

export const meta = {
  id: 'vercel',
  title: 'Vercel',
  description:
    "使用Supabase的应用程序启动和运行的最快方式是使用Vercel的Next.js启动器和Supabase集成。",
}

T本指南通过使用Vercel的仪表板来创建一个与Supabase集成的Next.js项目。为了进一步简化流程，我们将使用Next.js的启动模板，它可以自动分叉到新的GitHub repo，而无需离开仪表板

如果你没有Vercel账户，请创建一个[这里]（https://vercel.com/signup）。

## 第1步：创建一个Supabase项目

本指南可以使用现有的Supabase项目，但要从头开始创建`todo'演示，请导航到[Supabase](https://app.supabase.com/)，点击`Sign In'，用GitHub认证登录或注册一个新账户。

在Supabase的仪表板上，点击`新项目`并选择一个组织。

> 注意：你可能需要先创建一个组织。

给你的项目一个`名称`、`密码`，选择一个接近你的潜在用户的`区域`，然后点击`创建新项目`。

![Create a Supabase project](/docs/img/guides/integrations/vercel/create-supabase-project.png)

Supabase将花几分钟时间来配置基础设施。

一旦完成，从侧边栏菜单导航到 `SQL编辑器`，点击 `新查询`。

这将创建一个名为 `新查询`的新SQL片段。复制并粘贴以下内容，点击 `运行`。

```sql
create table todos (
  id bigint generated by default as identity primary key,
  title text,
  is_complete boolean default false,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

alter table todos enable row level security;

create policy "Anyone can view todos" on todos for
    select using (true);

create policy "Anyone can add new todos" on todos for
    insert with check (true);

insert into todos(title)
values
  ('Create Supabase project'),
  ('Create Vercel project'),
  ('Install Supabase integration');
```

这将创建一个新的todos表，启用行级安全，添加选择和插入数据的策略，并添加一些示例行。

> 注意：为了简化这个例子，我们允许任何人在 `todos`表上`选择`和`插入`行。通常情况下，这些操作会被锁定，只允许登录的用户执行。请看[这个视频](https://www.youtube.com/watch?v=Ow_Uzedfohk)以了解更多关于行级安全和策略的信息。

## 步骤2：创建Vercel项目

从你的[Vercel仪表板](https://vercel.com/dashboard)，点击`新项目`。

![Create new Vercel project](/docs/img/guides/integrations/vercel/create-vercel-project.png)

在 `克隆模板`菜单下，点击 `Next.js`。

![Clone Next.js template](/docs/img/guides/integrations/vercel/clone-next-js-template.png)

在 `创建 Git 仓库 `部分，点击 `GitHub`，在 `GIT SCOPE`下选择你的用户名，输入项目名称，选择你的仓库是 `私有`还是 `公共`，并点击 `创建`。

![New GitHub repo settings](/docs/img/guides/integrations/vercel/repo-settings.png)

这将创建一个新的GitHub仓库，克隆并提交Next.js启动项目，然后构建并部署你的新项目到Vercel。

一旦你被重定向到 `Congratulations` 屏幕，点击 `去仪表板`。

导航到 `设置`，`集成`，然后点击 `浏览市场`。

搜索`Supabase`并点击Supabase集成。

![Supabase integration](/docs/img/guides/integrations/vercel/supabase-integration.png)

点击 `添加集成`。从 `Vercel范围 `下拉菜单中选择您的账户，并点击 `继续`。

![Choose scope](/docs/img/guides/integrations/vercel/choose-scope.png)

选择 `特定项目`，从下拉菜单中选择你的新Vercel项目，然后点击 `添加集成`。

![Choose project](/docs/img/guides/integrations/vercel/choose-project.png)

从Supabase弹出窗口，从下拉菜单中选择你的新Vercel项目和Supabase项目。

![Supabase integration](/docs/img/guides/integrations/vercel/link-vercel-to-supabase.png)

## 第3步：克隆GitHub repo

让这个项目在本地运行的最快方法是克隆Vercel为我们创建的 repo。

回到Vercel项目的 `概览`页面，点击 `查看Git存储库`。

![Vercel Project Dashboard](/docs/img/guides/integrations/vercel/vercel-project-dashboard.png)

这将打开GitHub repo。在这里，点击 `代码`旁边的箭头，从下拉菜单中复制网址。

![GitHub repo url](/docs/img/guides/integrations/vercel/github-project-url.png)

打开终端窗口或CLI，运行以下命令来克隆GitHub repo。

```bash
git clone your-repo-url.git
```

在你选择的代码编辑器中打开该项目，并将`pages/index.js`的内容更新为以下内容。

```jsx
import styles from '../styles/Home.module.css'

export default function Home() {
  return <div className={styles.container}>working</div>
}
```

运行一个本地开发服务器。

```bash
npm run dev
```

导航到`http://localhost:3000`，确认该项目 `正在运行`。

## 第4步：从Vercel提取环境变量

首先，我们需要使用他们的CLI工具登录到Vercel。

```bash
npx vercel login
```

这将询问我们是否愿意安装`vercel`。输入`y`并点击`Enter`。

然后我们需要通过选择 `继续使用GitHub`来验证Vercel。

这将打开一个浏览器窗口，你需要用你的GitHub账户进行认证。

接下来，我们需要链接我们的Vercel项目。

```bash
npx vercel link
```

按照提示步骤，连接Vercel项目。

![Link project from Vercel](/docs/img/guides/integrations/vercel/vercel-link.png)

从我们的Vercel项目中复制环境变量。

```bash
npx vercel env pull
```

这将创建一个`.env`文件，包含我们的Supabase环境变量。把这个文件重命名为`.env.local`，以便从git上自动忽略它。

## 第五步：安装Supabase.js

Install the `supabase-js` library.

```bash
npm i @supabase/supabase-js
```

创建一个名为`/utils/supabase.js`的新文件并添加以下内容。

```jsx
import { createClient } from '@supabase/supabase-js'

export default createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
)
```

创建一个名为`/components/NewTodo.js`的新文件并添加以下内容。

```jsx
import { useState } from 'react'
import supabase from '../utils/supabase'

export default ({ reload }) => {
  const [title, setTitle] = useState('')

  const addTodo = async (e) => {
    e.preventDefault()
    await supabase.from('todos').insert({ title })
    reload()
    setTitle('')
  }

  return (
    <form onSubmit={addTodo}>
      <input value={title} onChange={(e) => setTitle(e.target.value)} />
    </form>
  )
}
```

这个组件将负责向Supabase写一个新的`todo`。

让我们在`pages/index.js`中导入我们的新组件，并显示一个todos的列表。

```jsx
import { useState, useEffect } from 'react'
import styles from '../styles/Home.module.css'
import supabase from '../utils/supabase'
import NewTodo from '../components/NewTodo'

export default function Home() {
  const [todos, setTodos] = useState([])

  const fetchTodos = async () => {
    const { data } = await supabase.from('todos').select('*')
    setTodos(data)
  }

  useEffect(() => {
    fetchTodos()
  }, [])

  return (
    <div className={styles.container}>
      <NewTodo reload={fetchTodos} />
      {todos.map((todo) => (
        <p key={todo.id}>{todo.title}</p>
      ))}
    </div>
  )
}
```

## 资源

- [Vercel 官方网站](https://vercel.com)。
- [Vercel博客](https://vercel.com/blog)。
- [Vercel docs](https://vercel.com/docs)。
- [Vercel集成文档](https://vercel.com/docs/integrations)

export const Page = ({ children }) => <Layout meta={meta} children={children} />

export default Page
